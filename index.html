<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Científica del Sur — Matriz 32×32</title>
  <link rel="stylesheet" href="style.css" />

  <!-- Feather Icons -->
  <script src="https://unpkg.com/feather-icons"></script>

  <!-- Pyodide -->
  <script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>
</head>

<body>

  <!-- PANTALLA DE BIENVENIDA -->
  <div id="landing" class="landing">
    <div class="landing-card fadeIn">
      <img id="landing-logo" src="logo.png" class="logo-big" alt="Logo" />
      <h1>Científica del Sur</h1>

      <p class="intro">
        Bienvenido al sistema farmacéutico matricial 32×32 de la Universidad Científica del Sur
      </p>

      <button id="enter-btn" class="primary">
        <i data-feather="log-in"></i> Entrar al sistema
      </button>
    </div>
  </div>

  <!-- APLICACIÓN -->
  <div id="app" class="hidden">

    <!-- HEADER -->
    <header class="header fadeIn">
      <div class="header-left">
        <img src="logo.png" class="logo-small" alt="logo" />
        <div>
          <h2>Sistema Matricial 32×32</h2>
          <p class="subtitle">Gestión Inteligente de Medicamentos</p>
        </div>
      </div>

      <div class="header-right">
        <button id="openManual" class="outline small" style="display:inline-flex;align-items:center;">
          <i data-feather="book"></i>&nbsp; Manual de uso
        </button>
      </div>
    </header>

    <main class="main">

      <!-- PANEL IZQUIERDO -->
      <aside class="panel-left">

        <div class="card">
          <h3><i data-feather="database"></i> Registrar medicamento</h3>

          <label>Fila (1-32)</label>
          <input id="inp-fila" type="number" min="1" max="32" value="1">

          <label>Columna (1-32)</label>
          <input id="inp-col" type="number" min="1" max="32" value="1">

          <label>Tipo</label>
          <select id="inp-tipo">
            <option>Analgésico</option>
            <option>Antibiótico</option>
            <option>Vitamina</option>
            <option>Vacuna</option>
            <option>Antiviral</option>
          </select>

          <label>Ubicación</label>
          <input id="inp-ubic" type="text" placeholder="Estante / Pasillo">

          <label>Lote</label>
          <input id="inp-lote" type="text" placeholder="L123">

          <label>Vencimiento (YYYY-MM-DD)</label>
          <input id="inp-venc" type="date">

          <label>Condiciones</label>
          <input id="inp-cond" type="text" placeholder="Ej: Seco / Refrigerado">

          <div class="row">
            <button id="btn-registrar" class="primary small">
              <i data-feather="check-circle"></i> Registrar
            </button>

            <button id="btn-rellenar" class="secondary small">
              <i data-feather="layers"></i> Rellenar 50
            </button>
          </div>

          <div id="msg-registrar" class="msg"></div>
        </div>

        <div class="card">
          <h3><i data-feather="cpu"></i> Operaciones</h3>

          <label>Tipo a analizar</label>
          <select id="tipo-analizar">
            <option>Analgésico</option>
            <option>Antibiótico</option>
            <option>Vitamina</option>
            <option>Vacuna</option>
            <option>Antiviral</option>
          </select>

          <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px;">
            <button id="btn-construir" class="outline small">
              <i data-feather="grid"></i> Construir matriz A
            </button>

            <button id="btn-fefo" class="outline small">
              <i data-feather="clock"></i> FEFO
            </button>

            <button id="btn-riesgo" class="outline small">
              <i data-feather="alert-triangle"></i> Riesgo
            </button>

            <button id="btn-compare" class="outline small">
              <i data-feather="trending-up"></i> Comparar tiempos
            </button>
          </div>

          <div style="margin-top:12px; display:flex; gap:8px;">
            <button id="btn-mostrar" class="primary small">
              <i data-feather="eye"></i> Mostrar matriz
            </button>

            <button id="btn-export" class="secondary small">
              <i data-feather="download"></i> Exportar CSV
            </button>
          </div>

        </div>

      </aside>

      <!-- PANEL DERECHO -->
      <section class="panel-right">

        <!-- ESTADÍSTICAS -->
        <div class="card">
          <h3><i data-feather="bar-chart-2"></i> Estadísticas del almacén</h3>

          <button id="btn-stats" class="outline small"><i data-feather="refresh-cw"></i> Actualizar estadísticas</button>

          <div id="stats-area" class="stats-box" style="margin-top:12px;">
            Clic en "Actualizar estadísticas" para ver conteos.
          </div>

          <hr style="margin:12px 0;">

          <label>Tipo a retirar</label>
          <select id="tipo-retirar">
            <option>Analgésico</option>
            <option>Antibiótico</option>
            <option>Vitamina</option>
            <option>Vacuna</option>
            <option>Antiviral</option>
          </select>

          <label>Cantidad</label>
          <input id="cant-retirar" type="number" min="1" value="1" style="width:120px;">

          <div style="margin-top:8px;">
            <button id="btn-retirar" class="secondary small"><i data-feather="minus-circle"></i> Retirar</button>
            <span id="retirar-msg" style="margin-left:10px;color:#6b7280"></span>
          </div>
        </div>

        <!-- MATRIZ -->
        <div class="card">
          <h3><i data-feather="table"></i> Matriz 32×32</h3>
          <div id="tabla-container" class="tabla-scroll"></div>
        </div>

        <!-- LOGS -->
        <div class="card">
          <h3><i data-feather="file-text"></i> Logs</h3>
          <pre id="output-log" class="log"></pre>
        </div>

      </section>

    </main>

    <footer class="footer">
      Portal Institucional — Científica del Sur
    </footer>

  </div>

  <!-- MANUAL modal simple (inicia oculto) -->
  <div id="manualModal" class="modal" style="display:none;">
    <div class="modal-content">
      <span id="closeManual" class="close">&times;</span>
      <h2>Manual de uso</h2>
      <ol>
        <li>Registrar medicamento: llenar fila(1-32), columna(1-32), tipo, lote, vencimiento, condiciones y presionar Registrar.</li>
        <li>Mostrar matriz: muestra la vista 1..32 con coordenadas.</li>
        <li>FEFO: listar productos por vencimiento para un tipo (usar campo "Tipo a analizar").</li>
        <li>Retirar: seleccionar tipo y cantidad, presionar Retirar y luego actualizar estadísticas.</li>
        <li>Exportar: descarga la matriz en texto plano.</li>
      </ol>
    </div>
  </div>

  <script src="script.js"></script>
  <script>feather.replace();</script>

</body>
</html>
